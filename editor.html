<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Editor Avanzato Torneo</title>
  <link rel="stylesheet" href="style.css">
  <style>
    textarea { width: 100%; min-height: 40px; margin-top: 5px; }
    .section { margin-top: 40px; }
    .item { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; background: #fff; }
    .item h4 { margin-top: 0; }
    .actions button { margin-right: 10px; }
  </style>
</head>
<body>
  <div class="container">
    <h2 style="text-align:center">Editor Avanzato Torneo</h2>

    <div class="section">
      <h3>📄 Anteprima dati.json</h3>
      <pre id="jsonPreview" style="white-space: pre-wrap; background:#eee; padding:10px; max-height:300px; overflow:auto;"></pre>
    </div>

    <div class="section">
      <h3>📂 Carica file dati.json</h3>
      <input type="file" id="fileInput">
    </div>

    <div class="section">
      <h3>📋 Seleziona Categoria</h3>
      <select id="selectCategoria"></select>
    </div>

    <div class="section">
      <h3>⚙️ Gestione Partite</h3>
      <div id="listaPartite"></div>
    </div>

    <script>
      let dati = {
        "Under 17": { "partite": [], "gironi": {}, "finali": [] },
        "Under 15": { "partite": [], "gironi": {}, "finali": [] },
        "Under 13": { "partite": [], "gironi": {}, "finali": [] },
        "2014/15": { "partite": [], "gironi": {}, "finali": [] },
        "2016/17": { "partite": [], "gironi": {}, "finali": [] },
        "Under 15 femminile": { "partite": [], "gironi": {}, "finali": [] },
        "Under 13 femminile": { "partite": [], "gironi": {}, "finali": [] }
      };

      function aggiornaAnteprima() {
        const preview = document.getElementById('jsonPreview');
        if (!preview) return;
        try {
          preview.textContent = JSON.stringify(dati, null, 2);
        } catch (e) {
          preview.textContent = "Errore nella generazione dell'anteprima.";
        }
      }

      document.getElementById("fileInput").addEventListener("change", e => {
        const reader = new FileReader();
        reader.onload = function(event) {
          try {
            dati = JSON.parse(event.target.result);
            aggiornaCategorie();
            alert("File caricato con successo!");
          } catch (err) {
            alert("Errore nel caricamento del file.");
          }
        };
        reader.readAsText(e.target.files[0]);
      });

      function aggiornaCategorie() {
        const select = document.getElementById("selectCategoria");
        select.innerHTML = "";
        Object.keys(dati).forEach(cat => {
          const opt = document.createElement("option");
          opt.value = cat;
          opt.textContent = cat;
          select.appendChild(opt);
        });
        if (select.options.length > 0) {
          select.selectedIndex = 0;
          aggiornaAnteprima();
        }
        select.onchange = () => {
          aggiornaAnteprima();
        };
      }

      aggiornaCategorie();
    </script>
</body>
</html>